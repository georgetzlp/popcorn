var te=Object.create;var Q=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ae=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ie(t))!oe.call(e,r)&&r!==n&&Q(e,r,{get:()=>t[r],enumerable:!(i=ne(t,r))||i.enumerable});return e};var ue=(e,t,n)=>(n=e!=null?te(re(e)):{},ae(t||!e||!e.__esModule?Q(n,"default",{value:e,enumerable:!0}):n,e));function O(e,t){let n={};for(let i in e)n[i]=t+e[i];return n}var T,f,Xe,Ze,$=k(()=>{T={main:"POPCORN_",quickCss:"QUICKCSS_"},f=O({getConfig:"GET_CONFIG",getStyles:"GET_STYLES",statusMessage:"STATUS_MESSAGE",getWindowData:"GET_WINDOW_DATA",log:"LOG",getThemes:"GET_THEMES",onThemeChange:"ON_THEME_CHANGE",saveThemeState:"SAVE_THEME_STATE",getQuickCss:"GET_QUICK_CSS",onQuickCssChange:"ON_QUICK_CSS_CHANGE",createQuickCssNode:"CREATE_QUICK_CSS_NODE",deleteQuickCssNode:"DELETE_QUICK_CSS_NODE",renameQuickCssNode:"RENAME_QUICK_CSS_NODE",updateQuickCssFile:"SAVE_QUICK_CSS_FILE"},T.main),Xe={quickCss:O({created:"CREATED",deleted:"DELETED",renamed:"RENAMED",updated:"UPDATED"},T.quickCss)},Ze=O({stop:"STOP"},T.main)});var D,L,I=k(()=>{$();D=class{module;output;constructor(t,n="console"){this.module=t,this.output=this.#t(n)}#t(t){switch(t){case"ansi":case"terminal":return"ansi";default:return"console"}}#n(t){switch(t){case"info":case"warn":case"error":case"debug":return t;default:return"log"}}#i(t){switch(t){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return{str:"gold",arr:[255,215,0]}}}#r(t,n){return`\x1B[38;2;${t[0]};${t[1]};${t[2]}m${n}\x1B[0m`}async#e(t,n){t=this.#n(t);let i=this.#i(t),r=this.output==="ansi"?[`[${this.#r(i.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${i.str};`,""];if(console[t](...r,...n),this.output==="ansi"){let{BrowserWindow:o}=await import("electron");o.getAllWindows().forEach(a=>a.webContents.send(f.log,t,...n))}}log=(...t)=>this.#e("log",t);info=(...t)=>this.#e("info",t);warn=(...t)=>this.#e("warn",t);error=(...t)=>this.#e("error",t);debug=(...t)=>this.#e("debug",t)},L=D});var H=h(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var G=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],U=[0,1,2,3];function se(e){if(e){if(e.medium&&!G.includes(e.medium))throw new Error(`The medium must be one of the following: ${G.join(", ")}`);if(e.warningLevel&&!U.includes(e.warningLevel))throw new Error(`The warning level must be one of the following: ${U.join(", ")}`);if(e.timeout!==void 0&&!Number.isInteger(e.timeout))throw new Error("The timeout must be an integer");if(e.timeout&&e.timeout<0)throw new Error("The timeout must be a positive integer")}}M.default=se});var j=h(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});var N=class extends Error{constructor(t,n){super(t),this.statusCode=n,this.name="BadStatusError"}};P.default=N});var S=h(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.boundaryLength=void 0;b.boundaryLength=34;var le=()=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let n=0;n<10;n+=1)t+=e[Math.floor(Math.random()*e.length)];return`----CSSValidatorBoundary${t}`};b.default=le});var W=h(w=>{"use strict";var ce=w&&w.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},de=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var fe=de(j()),_e=S(),ve=(e,t,n)=>ce(void 0,void 0,void 0,function*(){let i=new AbortController;setTimeout(()=>{i.abort()},n);let r=null;try{if(r=yield fetch(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,signal:i.signal},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,_e.boundaryLength+2)}`,"Content-Length":String(new TextEncoder().encode(t).byteLength)},body:t}:{})),!r.ok)throw new fe.default(r.statusText,r.status)}catch(a){throw a instanceof Error&&a.name==="AbortError"?new Error(`The request took longer than ${n}ms`):a}if(!r)throw new Error("Response expected");return(yield r.json()).cssvalidation});w.default=ve});var V=h(v=>{"use strict";var he=v&&v.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),we=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ge=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&he(t,e,n);return we(t,e),t},me=v&&v.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},ye=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var be=ge(require("https")),Ce=ye(j()),Ee=S(),Se=require("util"),pe=(e,t,n)=>me(void 0,void 0,void 0,function*(){return new Promise((i,r)=>{let o=be.request(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,timeout:n},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,Ee.boundaryLength+2)}`,"Content-Length":String(new Se.TextEncoder().encode(t).byteLength)}}:{}),a=>{var c;typeof a.statusCode=="number"&&(a.statusCode<200||a.statusCode>=300)&&r(new Ce.default((c=a.statusMessage)!==null&&c!==void 0?c:"",a.statusCode));let l="";a.on("data",s=>{try{l+=s}catch(u){r(u)}}),a.on("end",()=>{try{i(JSON.parse(l).cssvalidation)}catch(s){r(s)}})});e==="POST"&&o.write(t),o.on("timeout",()=>{r(new Error(`The request took longer than ${n}ms`))}),o.end()})});v.default=pe});var F=h(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});function Te(e){var t;let n={uri:encodeURIComponent(e.url),usermedium:(t=e?.medium)!==null&&t!==void 0?t:"all",warning:e?.warningLevel?e.warningLevel-1:"no",output:"application/json",profile:"css3"};return`?${Object.entries(n).map(([i,r])=>`${i}=${r}`).join("&")}`}q.default=Te});var K=h(C=>{"use strict";var Oe=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var $e=Oe(S()),De=e=>{var t;let n=`\r
`,i=`--${(0,$e.default)()}`,r=[`Content-Disposition: form-data; name="text"${n}${n}${e.text}${n}`,`Content-Disposition: form-data; name="profile"${n}${n}css3${n}`,`Content-Disposition: form-data; name="output"${n}${n}application/json${n}`,`Content-Disposition: form-data; name="usermedium"${n}${n}${(t=e.medium)!==null&&t!==void 0?t:"all"}${n}`,`Content-Disposition: form-data; name="warning"${n}${n}${e?.warningLevel?String(e.warningLevel-1):"no"}${n}`];return`${i}${n}${r.join(`${i}${n}`)}${i}`};C.default=De});var B=h(E=>{"use strict";var x=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0});var Le=x(F()),Me=x(K()),Ne=(e,t)=>{if(e==="GET"){if("text"in t)throw new Error("A GET request is not supported with validation by text");return(0,Le.default)(t)}if(e==="POST"){if("url"in t)throw new Error("A POST request is not supported with validation by URL");return(0,Me.default)(t)}throw new Error(`Parameter processing called with unrecognized method: ${e}`)};E.default=Ne});var A=h(g=>{"use strict";var Pe=g&&g.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},p=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});var je=p(H()),qe=p(W()),Ae=p(V()),Re=p(B()),Qe=(e,t,n)=>Pe(void 0,void 0,void 0,function*(){(0,je.default)({timeout:n,medium:t.medium,warningLevel:t.warningLevel});let i=(0,Re.default)(e,t);return typeof window<"u"&&typeof window?.fetch=="function"?yield(0,qe.default)(e,i,n):yield(0,Ae.default)(e,i,n)});g.default=Qe});var Y=h(m=>{"use strict";var ke=m&&m.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Ie=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var Ge=Ie(A());function Ue(e,t){var n,i,r;return ke(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in text to be validated");if(typeof e!="string")throw new Error("The text to be validated must be a string");let o=yield(0,Ge.default)("POST",{text:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),a={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},a),{warnings:[]}):a;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim()})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1})})),c})}m.default=Ue});var z=h(y=>{"use strict";var He=y&&y.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},We=y&&y.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(y,"__esModule",{value:!0});var Ve=We(A());function Fe(e,t){var n,i,r;return He(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in a URL to be validated");if(typeof e!="string")throw new Error("The URL to be validated must be a string");let o=yield(0,Ve.default)("GET",{url:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),a={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},a),{warnings:[]}):a;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{var s;c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),url:(s=l.source)!==null&&s!==void 0?s:null})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{var s;c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1,url:(s=l.source)!==null&&s!==void 0?s:null})})),c})}y.default=Fe});var Z=h((R,X)=>{"use strict";var J=R&&R.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Ke=J(Y()),xe=J(z()),Be={validateText:Ke.default,validateURL:xe.default};X.exports=Be});var _=require("electron");$();I();var Ye=new L("Preload"),ee={config:_.ipcRenderer.sendSync(f.getConfig),getStyles:()=>_.ipcRenderer.invoke(f.getStyles),onStatusMessage:e=>_.ipcRenderer.on(f.statusMessage,(t,n)=>e(n)),isSplash:ze(),getThemes:()=>_.ipcRenderer.invoke(f.getThemes),onThemeChange:e=>_.ipcRenderer.on(f.onThemeChange,(t,n)=>e(n)),saveThemeState:(e,t)=>_.ipcRenderer.send(f.saveThemeState,e,t),getQuickCss:()=>_.ipcRenderer.invoke(f.getQuickCss),onQuickCssChange:e=>_.ipcRenderer.on(f.onQuickCssChange,(t,n)=>e(n)),createQuickCssNode:(e,t)=>_.ipcRenderer.send(f.createQuickCssNode,e,t),deleteQuickCssNode:e=>_.ipcRenderer.send(f.deleteQuickCssNode,e),renameQuickCssNode:(e,t)=>_.ipcRenderer.send(f.renameQuickCssNode,e,t),updateQuickCssFile:(e,t)=>_.ipcRenderer.send(f.updateQuickCssFile,e,t)};try{let e=Z();ee.validateCSS=e.validateText}catch{Ye.info("Disabled CSS Validator")}_.contextBridge.exposeInMainWorld("PopcornNative",ee);_.ipcRenderer.on(f.log,(e,t,...n)=>{new L("Main")[t](...n)});function ze(){let e=["splash","Splash","SPLASH","__SPLASH","__SPLASH__","splashScreen","SplashScreen","SPLASHSCREEN","__SPLASHSCREEN","__SPLASHSCREEN__"];for(let n of e)if(window[n])return!0;let{windowOptions:t}=_.ipcRenderer.sendSync(f.getWindowData);return!t.webPreferences.nativeWindowOpen}
