var J=Object.create;var R=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var te=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of X(t))!ee.call(e,r)&&r!==n&&R(e,r,{get:()=>t[r],enumerable:!(i=x(t,r))||i.enumerable});return e};var ne=(e,t,n)=>(n=e!=null?J(Z(e)):{},te(t||!e||!e.__esModule?R(n,"default",{value:e,enumerable:!0}):n,e));var k=h(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var q=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],Q=[0,1,2,3];function ie(e){if(e){if(e.medium&&!q.includes(e.medium))throw new Error(`The medium must be one of the following: ${q.join(", ")}`);if(e.warningLevel&&!Q.includes(e.warningLevel))throw new Error(`The warning level must be one of the following: ${Q.join(", ")}`);if(e.timeout!==void 0&&!Number.isInteger(e.timeout))throw new Error("The timeout must be an integer");if(e.timeout&&e.timeout<0)throw new Error("The timeout must be a positive integer")}}T.default=ie});var N=h(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});var S=class extends Error{constructor(t,n){super(t),this.statusCode=n,this.name="BadStatusError"}};L.default=S});var p=h(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.boundaryLength=void 0;m.boundaryLength=34;var re=()=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let n=0;n<10;n+=1)t+=e[Math.floor(Math.random()*e.length)];return`----CSSValidatorBoundary${t}`};m.default=re});var I=h(w=>{"use strict";var oe=w&&w.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{s(i.next(a))}catch(d){u(d)}}function l(a){try{s(i.throw(a))}catch(d){u(d)}}function s(a){a.done?o(a.value):r(a.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},ue=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var ae=ue(N()),se=p(),le=(e,t,n)=>oe(void 0,void 0,void 0,function*(){let i=new AbortController;setTimeout(()=>{i.abort()},n);let r=null;try{if(r=yield fetch(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,signal:i.signal},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,se.boundaryLength+2)}`,"Content-Length":String(new TextEncoder().encode(t).byteLength)},body:t}:{})),!r.ok)throw new ae.default(r.statusText,r.status)}catch(u){throw u instanceof Error&&u.name==="AbortError"?new Error(`The request took longer than ${n}ms`):u}if(!r)throw new Error("Response expected");return(yield r.json()).cssvalidation});w.default=le});var A=h(v=>{"use strict";var ce=v&&v.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),de=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),fe=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&ce(t,e,n);return de(t,e),t},_e=v&&v.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{s(i.next(a))}catch(d){u(d)}}function l(a){try{s(i.throw(a))}catch(d){u(d)}}function s(a){a.done?o(a.value):r(a.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},ve=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var he=fe(require("https")),we=ve(N()),ge=p(),Ce=require("util"),be=(e,t,n)=>_e(void 0,void 0,void 0,function*(){return new Promise((i,r)=>{let o=he.request(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,timeout:n},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,ge.boundaryLength+2)}`,"Content-Length":String(new Ce.TextEncoder().encode(t).byteLength)}}:{}),u=>{var c;typeof u.statusCode=="number"&&(u.statusCode<200||u.statusCode>=300)&&r(new we.default((c=u.statusMessage)!==null&&c!==void 0?c:"",u.statusCode));let l="";u.on("data",s=>{try{l+=s}catch(a){r(a)}}),u.on("end",()=>{try{i(JSON.parse(l).cssvalidation)}catch(s){r(s)}})});e==="POST"&&o.write(t),o.on("timeout",()=>{r(new Error(`The request took longer than ${n}ms`))}),o.end()})});v.default=be});var G=h(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});function me(e){var t;let n={uri:encodeURIComponent(e.url),usermedium:(t=e?.medium)!==null&&t!==void 0?t:"all",warning:e?.warningLevel?e.warningLevel-1:"no",output:"application/json",profile:"css3"};return`?${Object.entries(n).map(([i,r])=>`${i}=${r}`).join("&")}`}M.default=me});var U=h(y=>{"use strict";var ye=y&&y.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(y,"__esModule",{value:!0});var Oe=ye(p()),pe=e=>{var t;let n=`\r
`,i=`--${(0,Oe.default)()}`,r=[`Content-Disposition: form-data; name="text"${n}${n}${e.text}${n}`,`Content-Disposition: form-data; name="profile"${n}${n}css3${n}`,`Content-Disposition: form-data; name="output"${n}${n}application/json${n}`,`Content-Disposition: form-data; name="usermedium"${n}${n}${(t=e.medium)!==null&&t!==void 0?t:"all"}${n}`,`Content-Disposition: form-data; name="warning"${n}${n}${e?.warningLevel?String(e.warningLevel-1):"no"}${n}`];return`${i}${n}${r.join(`${i}${n}`)}${i}`};y.default=pe});var K=h(O=>{"use strict";var F=O&&O.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(O,"__esModule",{value:!0});var Ee=F(G()),$e=F(U()),Pe=(e,t)=>{if(e==="GET"){if("text"in t)throw new Error("A GET request is not supported with validation by text");return(0,Ee.default)(t)}if(e==="POST"){if("url"in t)throw new Error("A POST request is not supported with validation by URL");return(0,$e.default)(t)}throw new Error(`Parameter processing called with unrecognized method: ${e}`)};O.default=Pe});var D=h(g=>{"use strict";var Te=g&&g.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{s(i.next(a))}catch(d){u(d)}}function l(a){try{s(i.throw(a))}catch(d){u(d)}}function s(a){a.done?o(a.value):r(a.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},E=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});var Se=E(k()),Le=E(I()),Ne=E(A()),Me=E(K()),De=(e,t,n)=>Te(void 0,void 0,void 0,function*(){(0,Se.default)({timeout:n,medium:t.medium,warningLevel:t.warningLevel});let i=(0,Me.default)(e,t);return typeof window<"u"&&typeof window?.fetch=="function"?yield(0,Le.default)(e,i,n):yield(0,Ne.default)(e,i,n)});g.default=De});var B=h(C=>{"use strict";var je=C&&C.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{s(i.next(a))}catch(d){u(d)}}function l(a){try{s(i.throw(a))}catch(d){u(d)}}function s(a){a.done?o(a.value):r(a.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Re=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var qe=Re(D());function Qe(e,t){var n,i,r;return je(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in text to be validated");if(typeof e!="string")throw new Error("The text to be validated must be a string");let o=yield(0,qe.default)("POST",{text:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),u={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},u),{warnings:[]}):u;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim()})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1})})),c})}C.default=Qe});var V=h(b=>{"use strict";var ke=b&&b.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{s(i.next(a))}catch(d){u(d)}}function l(a){try{s(i.throw(a))}catch(d){u(d)}}function s(a){a.done?o(a.value):r(a.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Ie=b&&b.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b,"__esModule",{value:!0});var Ae=Ie(D());function Ge(e,t){var n,i,r;return ke(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in a URL to be validated");if(typeof e!="string")throw new Error("The URL to be validated must be a string");let o=yield(0,Ae.default)("GET",{url:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),u={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},u),{warnings:[]}):u;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{var s;c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),url:(s=l.source)!==null&&s!==void 0?s:null})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{var s;c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1,url:(s=l.source)!==null&&s!==void 0?s:null})})),c})}b.default=Ge});var Y=h((j,W)=>{"use strict";var H=j&&j.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Ue=H(B()),Fe=H(V()),Ke={validateText:Ue.default,validateURL:Fe.default};W.exports=Ke});var _=require("electron");var f={getConfig:"POPCORN_GET_CONFIG",statusMessage:"POPCORN_STATUS_MESSAGE",log:"POPCORN_LOG",getThemes:"POPCORN_GET_THEMES",onThemeChange:"POPCORN_ON_THEME_CHANGE",saveThemeState:"POPCORN_SAVE_STATE",getQuickCss:"POPCORN_GET_QUICK_CSS",onQuickCssChange:"POPCORN_ON_QUICK_CSS_CHANGE",createQuickCssNode:"POPCORN_CREATE_QUICK_CSS_NODE",deleteQuickCssNode:"POPCORN_DELETE_QUICK_CSS_NODE",renameQuickCssNode:"POPCORN_RENAME_QUICK_CSS_NODE",updateQuickCssFile:"POPCORN_SAVE_QUICK_CSS_FILE"};var $=class{module;output;constructor(t,n="console"){this.module=t,this.output=this.#t(n)}#t(t){switch(t){case"ansi":case"terminal":return"ansi";default:return"console"}}#n(t){switch(t){case"info":case"warn":case"error":case"debug":return t;default:return"log"}}#i(t){switch(t){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return{str:"gold",arr:[255,215,0]}}}#r(t,n){return`\x1B[38;2;${t[0]};${t[1]};${t[2]}m${n}\x1B[0m`}async#e(t,n){t=this.#n(t);let i=this.#i(t),r=this.output==="ansi"?[`[${this.#r(i.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${i.str};`,""];if(console[t](...r,...n),this.output==="ansi"){let{BrowserWindow:o}=await import("electron");o.getAllWindows().forEach(u=>u.webContents.send(f.log,t,...n))}}log=(...t)=>this.#e("log",t);info=(...t)=>this.#e("info",t);warn=(...t)=>this.#e("warn",t);error=(...t)=>this.#e("error",t);debug=(...t)=>this.#e("debug",t)},P=$;var Be=new P("Preload"),Ve=_.ipcRenderer.invoke(f.getConfig),z={config:Ve,getThemes:()=>_.ipcRenderer.invoke(f.getThemes),onThemeChange:e=>_.ipcRenderer.on(f.onThemeChange,(t,n)=>e(n)),saveThemeState:(e,t)=>_.ipcRenderer.send(f.saveThemeState,e,t),getQuickCss:()=>_.ipcRenderer.invoke(f.getQuickCss),onQuickCssChange:e=>_.ipcRenderer.on(f.onQuickCssChange,(t,n)=>e(n)),createQuickCssNode:(e,t)=>_.ipcRenderer.send(f.createQuickCssNode,e,t),deleteQuickCssNode:e=>_.ipcRenderer.send(f.deleteQuickCssNode,e),renameQuickCssNode:(e,t)=>_.ipcRenderer.send(f.renameQuickCssNode,e,t),updateQuickCssFile:(e,t)=>_.ipcRenderer.send(f.updateQuickCssFile,e,t)};try{let e=Y();z.validateCSS=e.validateText}catch{Be.info("Disabled CSS Validator")}_.contextBridge.exposeInMainWorld("PopcornNative",z);_.ipcRenderer.on(f.log,(e,t,...n)=>{new P("Main")[t](...n)});
