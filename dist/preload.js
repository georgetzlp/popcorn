var X=Object.create;var q=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ie=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ee(t))!ne.call(e,r)&&r!==n&&q(e,r,{get:()=>t[r],enumerable:!(i=Z(t,r))||i.enumerable});return e};var re=(e,t,n)=>(n=e!=null?X(te(e)):{},ie(t||!e||!e.__esModule?q(n,"default",{value:e,enumerable:!0}):n,e));var I=h(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var R=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],k=[0,1,2,3];function oe(e){if(e){if(e.medium&&!R.includes(e.medium))throw new Error(`The medium must be one of the following: ${R.join(", ")}`);if(e.warningLevel&&!k.includes(e.warningLevel))throw new Error(`The warning level must be one of the following: ${k.join(", ")}`);if(e.timeout!==void 0&&!Number.isInteger(e.timeout))throw new Error("The timeout must be an integer");if(e.timeout&&e.timeout<0)throw new Error("The timeout must be a positive integer")}}O.default=oe});var M=h(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});var L=class extends Error{constructor(t,n){super(t),this.statusCode=n,this.name="BadStatusError"}};D.default=L});var E=h(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.boundaryLength=void 0;C.boundaryLength=34;var ae=()=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let n=0;n<10;n+=1)t+=e[Math.floor(Math.random()*e.length)];return`----CSSValidatorBoundary${t}`};C.default=ae});var G=h(w=>{"use strict";var ue=w&&w.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},se=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var le=se(M()),ce=E(),de=(e,t,n)=>ue(void 0,void 0,void 0,function*(){let i=new AbortController;setTimeout(()=>{i.abort()},n);let r=null;try{if(r=yield fetch(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,signal:i.signal},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,ce.boundaryLength+2)}`,"Content-Length":String(new TextEncoder().encode(t).byteLength)},body:t}:{})),!r.ok)throw new le.default(r.statusText,r.status)}catch(a){throw a instanceof Error&&a.name==="AbortError"?new Error(`The request took longer than ${n}ms`):a}if(!r)throw new Error("Response expected");return(yield r.json()).cssvalidation});w.default=de});var U=h(v=>{"use strict";var fe=v&&v.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),_e=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ve=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&fe(t,e,n);return _e(t,e),t},he=v&&v.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},we=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var ge=ve(require("https")),me=we(M()),be=E(),Ce=require("util"),ye=(e,t,n)=>he(void 0,void 0,void 0,function*(){return new Promise((i,r)=>{let o=ge.request(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,timeout:n},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,be.boundaryLength+2)}`,"Content-Length":String(new Ce.TextEncoder().encode(t).byteLength)}}:{}),a=>{var c;typeof a.statusCode=="number"&&(a.statusCode<200||a.statusCode>=300)&&r(new me.default((c=a.statusMessage)!==null&&c!==void 0?c:"",a.statusCode));let l="";a.on("data",s=>{try{l+=s}catch(u){r(u)}}),a.on("end",()=>{try{i(JSON.parse(l).cssvalidation)}catch(s){r(s)}})});e==="POST"&&o.write(t),o.on("timeout",()=>{r(new Error(`The request took longer than ${n}ms`))}),o.end()})});v.default=ye});var H=h(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});function pe(e){var t;let n={uri:encodeURIComponent(e.url),usermedium:(t=e?.medium)!==null&&t!==void 0?t:"all",warning:e?.warningLevel?e.warningLevel-1:"no",output:"application/json",profile:"css3"};return`?${Object.entries(n).map(([i,r])=>`${i}=${r}`).join("&")}`}P.default=pe});var W=h(y=>{"use strict";var Ee=y&&y.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(y,"__esModule",{value:!0});var Se=Ee(E()),Te=e=>{var t;let n=`\r
`,i=`--${(0,Se.default)()}`,r=[`Content-Disposition: form-data; name="text"${n}${n}${e.text}${n}`,`Content-Disposition: form-data; name="profile"${n}${n}css3${n}`,`Content-Disposition: form-data; name="output"${n}${n}application/json${n}`,`Content-Disposition: form-data; name="usermedium"${n}${n}${(t=e.medium)!==null&&t!==void 0?t:"all"}${n}`,`Content-Disposition: form-data; name="warning"${n}${n}${e?.warningLevel?String(e.warningLevel-1):"no"}${n}`];return`${i}${n}${r.join(`${i}${n}`)}${i}`};y.default=Te});var K=h(p=>{"use strict";var F=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var $e=F(H()),Oe=F(W()),Le=(e,t)=>{if(e==="GET"){if("text"in t)throw new Error("A GET request is not supported with validation by text");return(0,$e.default)(t)}if(e==="POST"){if("url"in t)throw new Error("A POST request is not supported with validation by URL");return(0,Oe.default)(t)}throw new Error(`Parameter processing called with unrecognized method: ${e}`)};p.default=Le});var N=h(g=>{"use strict";var De=g&&g.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},S=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});var Me=S(I()),Pe=S(G()),Ne=S(U()),je=S(K()),qe=(e,t,n)=>De(void 0,void 0,void 0,function*(){(0,Me.default)({timeout:n,medium:t.medium,warningLevel:t.warningLevel});let i=(0,je.default)(e,t);return typeof window<"u"&&typeof window?.fetch=="function"?yield(0,Pe.default)(e,i,n):yield(0,Ne.default)(e,i,n)});g.default=qe});var V=h(m=>{"use strict";var Ae=m&&m.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Qe=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var Re=Qe(N());function ke(e,t){var n,i,r;return Ae(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in text to be validated");if(typeof e!="string")throw new Error("The text to be validated must be a string");let o=yield(0,Re.default)("POST",{text:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),a={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},a),{warnings:[]}):a;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim()})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1})})),c})}m.default=ke});var x=h(b=>{"use strict";var Ie=b&&b.__awaiter||function(e,t,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(u){try{s(i.next(u))}catch(d){a(d)}}function l(u){try{s(i.throw(u))}catch(d){a(d)}}function s(u){u.done?o(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Ge=b&&b.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b,"__esModule",{value:!0});var Ue=Ge(N());function He(e,t){var n,i,r;return Ie(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in a URL to be validated");if(typeof e!="string")throw new Error("The URL to be validated must be a string");let o=yield(0,Ue.default)("GET",{url:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),a={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},a),{warnings:[]}):a;return c.valid=o.validity,(i=o.errors)===null||i===void 0||i.forEach(l=>{var s;c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),url:(s=l.source)!==null&&s!==void 0?s:null})}),"warnings"in c&&((r=o.warnings)===null||r===void 0||r.forEach(l=>{var s;c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1,url:(s=l.source)!==null&&s!==void 0?s:null})})),c})}b.default=He});var z=h((j,Y)=>{"use strict";var B=j&&j.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},We=B(V()),Fe=B(x()),Ke={validateText:We.default,validateURL:Fe.default};Y.exports=Ke});var _=require("electron");var A={main:"POPCORN_",quickCss:"QUICKCSS_",themes:"THEMES_"},f=Q({getConfig:"GET_CONFIG",statusMessage:"STATUS_MESSAGE",getWindowData:"GET_WINDOW_DATA",log:"LOG",getThemes:"GET_THEMES",onThemeChange:"ON_THEME_CHANGE",saveThemeState:"SAVE_THEME_STATE",getQuickCss:"GET_QUICK_CSS",onQuickCssChange:"ON_QUICK_CSS_CHANGE",createQuickCssNode:"CREATE_QUICK_CSS_NODE",deleteQuickCssNode:"DELETE_QUICK_CSS_NODE",renameQuickCssNode:"RENAME_QUICK_CSS_NODE",updateQuickCssFile:"SAVE_QUICK_CSS_FILE"},A.main),ze={quickCss:Q({created:"CREATED",deleted:"DELETED",renamed:"RENAMED",updated:"UPDATED"},A.quickCss)};function Q(e,t){let n={};for(let i in e)n[i]=t+e[i];return n}var T=class{module;output;constructor(t,n="console"){this.module=t,this.output=this.#t(n)}#t(t){switch(t){case"ansi":case"terminal":return"ansi";default:return"console"}}#n(t){switch(t){case"info":case"warn":case"error":case"debug":return t;default:return"log"}}#i(t){switch(t){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return{str:"gold",arr:[255,215,0]}}}#r(t,n){return`\x1B[38;2;${t[0]};${t[1]};${t[2]}m${n}\x1B[0m`}async#e(t,n){t=this.#n(t);let i=this.#i(t),r=this.output==="ansi"?[`[${this.#r(i.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${i.str};`,""];if(console[t](...r,...n),this.output==="ansi"){let{BrowserWindow:o}=await import("electron");o.getAllWindows().forEach(a=>a.webContents.send(f.log,t,...n))}}log=(...t)=>this.#e("log",t);info=(...t)=>this.#e("info",t);warn=(...t)=>this.#e("warn",t);error=(...t)=>this.#e("error",t);debug=(...t)=>this.#e("debug",t)},$=T;var Ve=new $("Preload"),xe=_.ipcRenderer.invoke(f.getConfig),J={config:xe,onStatusMessage:e=>_.ipcRenderer.on(f.statusMessage,(t,n)=>e(n)),isSplash:Be(),getThemes:()=>_.ipcRenderer.invoke(f.getThemes),onThemeChange:e=>_.ipcRenderer.on(f.onThemeChange,(t,n)=>e(n)),saveThemeState:(e,t)=>_.ipcRenderer.send(f.saveThemeState,e,t),getQuickCss:()=>_.ipcRenderer.invoke(f.getQuickCss),onQuickCssChange:e=>_.ipcRenderer.on(f.onQuickCssChange,(t,n)=>e(n)),createQuickCssNode:(e,t)=>_.ipcRenderer.send(f.createQuickCssNode,e,t),deleteQuickCssNode:e=>_.ipcRenderer.send(f.deleteQuickCssNode,e),renameQuickCssNode:(e,t)=>_.ipcRenderer.send(f.renameQuickCssNode,e,t),updateQuickCssFile:(e,t)=>_.ipcRenderer.send(f.updateQuickCssFile,e,t)};try{let e=z();J.validateCSS=e.validateText}catch{Ve.info("Disabled CSS Validator")}_.contextBridge.exposeInMainWorld("PopcornNative",J);_.ipcRenderer.on(f.log,(e,t,...n)=>{new $("Main")[t](...n)});function Be(){let e=["splash","Splash","SPLASH","__SPLASH","__SPLASH__","splashScreen","SplashScreen","SPLASHSCREEN","__SPLASHSCREEN","__SPLASHSCREEN__"];for(let n of e)if(window[n])return!0;let{windowOptions:t}=_.ipcRenderer.sendSync(f.getWindowData);return!t.webPreferences.nativeWindowOpen}
