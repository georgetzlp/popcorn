var ee=Object.create;var R=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var oe=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ne(t))!re.call(e,r)&&r!==n&&R(e,r,{get:()=>t[r],enumerable:!(i=te(t,r))||i.enumerable});return e};var k=(e,t,n)=>(n=e!=null?ee(ie(e)):{},oe(t||!e||!e.__esModule?R(n,"default",{value:e,enumerable:!0}):n,e));var U=h(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});var I=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],G=[0,1,2,3];function ae(e){if(e){if(e.medium&&!I.includes(e.medium))throw new Error(`The medium must be one of the following: ${I.join(", ")}`);if(e.warningLevel&&!G.includes(e.warningLevel))throw new Error(`The warning level must be one of the following: ${G.join(", ")}`);if(e.timeout!==void 0&&!Number.isInteger(e.timeout))throw new Error("The timeout must be an integer");if(e.timeout&&e.timeout<0)throw new Error("The timeout must be a positive integer")}}D.default=ae});var P=h(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});var M=class extends Error{constructor(t,n){super(t),this.statusCode=n,this.name="BadStatusError"}};N.default=M});var S=h(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.boundaryLength=void 0;y.boundaryLength=34;var se=()=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let n=0;n<10;n+=1)t+=e[Math.floor(Math.random()*e.length)];return`----CSSValidatorBoundary${t}`};y.default=se});var H=h(g=>{"use strict";var ue=g&&g.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(s){try{u(i.next(s))}catch(d){o(d)}}function l(s){try{u(i.throw(s))}catch(d){o(d)}}function u(s){s.done?a(s.value):r(s.value).then(c,l)}u((i=i.apply(e,t||[])).next())})},le=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});var ce=le(P()),de=S(),fe=(e,t,n)=>ue(void 0,void 0,void 0,function*(){let i=new AbortController;setTimeout(()=>{i.abort()},n);let r=null;try{if(r=yield fetch(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,signal:i.signal},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,de.boundaryLength+2)}`,"Content-Length":String(new TextEncoder().encode(t).byteLength)},body:t}:{})),!r.ok)throw new ce.default(r.statusText,r.status)}catch(o){throw o instanceof Error&&o.name==="AbortError"?new Error(`The request took longer than ${n}ms`):o}if(!r)throw new Error("Response expected");return(yield r.json()).cssvalidation});g.default=fe});var K=h(v=>{"use strict";var _e=v&&v.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),ve=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),he=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&_e(t,e,n);return ve(t,e),t},ge=v&&v.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(s){try{u(i.next(s))}catch(d){o(d)}}function l(s){try{u(i.throw(s))}catch(d){o(d)}}function u(s){s.done?a(s.value):r(s.value).then(c,l)}u((i=i.apply(e,t||[])).next())})},we=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var pe=he(require("https")),me=we(P()),ye=S(),Ce=require("util"),be=(e,t,n)=>ge(void 0,void 0,void 0,function*(){return new Promise((i,r)=>{let a=pe.request(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,timeout:n},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,ye.boundaryLength+2)}`,"Content-Length":String(new Ce.TextEncoder().encode(t).byteLength)}}:{}),o=>{var c;typeof o.statusCode=="number"&&(o.statusCode<200||o.statusCode>=300)&&r(new me.default((c=o.statusMessage)!==null&&c!==void 0?c:"",o.statusCode));let l="";o.on("data",u=>{try{l+=u}catch(s){r(s)}}),o.on("end",()=>{try{i(JSON.parse(l).cssvalidation)}catch(u){r(u)}})});e==="POST"&&a.write(t),a.on("timeout",()=>{r(new Error(`The request took longer than ${n}ms`))}),a.end()})});v.default=be});var V=h(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});function Se(e){var t;let n={uri:encodeURIComponent(e.url),usermedium:(t=e?.medium)!==null&&t!==void 0?t:"all",warning:e?.warningLevel?e.warningLevel-1:"no",output:"application/json",profile:"css3"};return`?${Object.entries(n).map(([i,r])=>`${i}=${r}`).join("&")}`}j.default=Se});var F=h(C=>{"use strict";var Ee=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var Te=Ee(S()),Oe=e=>{var t;let n=`\r
`,i=`--${(0,Te.default)()}`,r=[`Content-Disposition: form-data; name="text"${n}${n}${e.text}${n}`,`Content-Disposition: form-data; name="profile"${n}${n}css3${n}`,`Content-Disposition: form-data; name="output"${n}${n}application/json${n}`,`Content-Disposition: form-data; name="usermedium"${n}${n}${(t=e.medium)!==null&&t!==void 0?t:"all"}${n}`,`Content-Disposition: form-data; name="warning"${n}${n}${e?.warningLevel?String(e.warningLevel-1):"no"}${n}`];return`${i}${n}${r.join(`${i}${n}`)}${i}`};C.default=Oe});var x=h(b=>{"use strict";var W=b&&b.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b,"__esModule",{value:!0});var Le=W(V()),$e=W(F()),De=(e,t)=>{if(e==="GET"){if("text"in t)throw new Error("A GET request is not supported with validation by text");return(0,Le.default)(t)}if(e==="POST"){if("url"in t)throw new Error("A POST request is not supported with validation by URL");return(0,$e.default)(t)}throw new Error(`Parameter processing called with unrecognized method: ${e}`)};b.default=De});var A=h(w=>{"use strict";var Me=w&&w.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(s){try{u(i.next(s))}catch(d){o(d)}}function l(s){try{u(i.throw(s))}catch(d){o(d)}}function u(s){s.done?a(s.value):r(s.value).then(c,l)}u((i=i.apply(e,t||[])).next())})},E=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var Ne=E(U()),Pe=E(H()),je=E(K()),Ae=E(x()),qe=(e,t,n)=>Me(void 0,void 0,void 0,function*(){(0,Ne.default)({timeout:n,medium:t.medium,warningLevel:t.warningLevel});let i=(0,Ae.default)(e,t);return typeof window<"u"&&typeof window?.fetch=="function"?yield(0,Pe.default)(e,i,n):yield(0,je.default)(e,i,n)});w.default=qe});var B=h(p=>{"use strict";var Qe=p&&p.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(s){try{u(i.next(s))}catch(d){o(d)}}function l(s){try{u(i.throw(s))}catch(d){o(d)}}function u(s){s.done?a(s.value):r(s.value).then(c,l)}u((i=i.apply(e,t||[])).next())})},Re=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var ke=Re(A());function Ie(e,t){var n,i,r;return Qe(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in text to be validated");if(typeof e!="string")throw new Error("The text to be validated must be a string");let a=yield(0,ke.default)("POST",{text:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),o={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},o),{warnings:[]}):o;return c.valid=a.validity,(i=a.errors)===null||i===void 0||i.forEach(l=>{c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim()})}),"warnings"in c&&((r=a.warnings)===null||r===void 0||r.forEach(l=>{c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1})})),c})}p.default=Ie});var Y=h(m=>{"use strict";var Ge=m&&m.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(s){try{u(i.next(s))}catch(d){o(d)}}function l(s){try{u(i.throw(s))}catch(d){o(d)}}function u(s){s.done?a(s.value):r(s.value).then(c,l)}u((i=i.apply(e,t||[])).next())})},Ue=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var He=Ue(A());function Ke(e,t){var n,i,r;return Ge(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in a URL to be validated");if(typeof e!="string")throw new Error("The URL to be validated must be a string");let a=yield(0,He.default)("GET",{url:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),o={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},o),{warnings:[]}):o;return c.valid=a.validity,(i=a.errors)===null||i===void 0||i.forEach(l=>{var u;c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),url:(u=l.source)!==null&&u!==void 0?u:null})}),"warnings"in c&&((r=a.warnings)===null||r===void 0||r.forEach(l=>{var u;c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1,url:(u=l.source)!==null&&u!==void 0?u:null})})),c})}m.default=Ke});var X=h((q,J)=>{"use strict";var z=q&&q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Ve=z(B()),Fe=z(Y()),We={validateText:Ve.default,validateURL:Fe.default};J.exports=We});var _=require("electron");var T={main:"POPCORN_",quickCss:"QUICKCSS_"},f=O({getConfig:"GET_CONFIG",getStyles:"GET_STYLES",statusMessage:"STATUS_MESSAGE",log:"LOG",getThemes:"GET_THEMES",onThemeChange:"ON_THEME_CHANGE",saveThemeState:"SAVE_THEME_STATE",getQuickCss:"GET_QUICK_CSS",onQuickCssChange:"ON_QUICK_CSS_CHANGE",createQuickCssNode:"CREATE_QUICK_CSS_NODE",deleteQuickCssNode:"DELETE_QUICK_CSS_NODE",renameQuickCssNode:"RENAME_QUICK_CSS_NODE",updateQuickCssFile:"SAVE_QUICK_CSS_FILE"},T.main),Ye={quickCss:O({created:"CREATED",deleted:"DELETED",renamed:"RENAMED",updated:"UPDATED"},T.quickCss)},ze=O({stop:"STOP"},T.main);function O(e,t){let n={};for(let i in e)n[i]=t+e[i];return n}var L=class e{constructor(t,n="console"){this.module=t;this.output=e.getOutput(n),this.output==="ansi"&&(this.logArchive=[],(async()=>{let{app:i}=await import("electron");i.on("web-contents-created",(r,a)=>{for(let o of this.logArchive)a.send(f.log,o.type,...o.message)})})())}output;logArchive;static getOutput(t){switch(t){case"ansi":case"terminal":return"ansi";default:return"console"}}static getColor(t){switch(t){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return{str:"gold",arr:[255,215,0]}}}static ansiColor(t,n){return`\x1B[38;2;${t[0]};${t[1]};${t[2]}m${n}\x1B[0m`}async#e(t,n){let i=e.getColor(t),r=this.output==="ansi"?[`[${e.ansiColor(i.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${i.str};`,""];if(console[t](...r,...n),this.output==="ansi"){let{BrowserWindow:a}=await import("electron");this.logArchive.push({type:t,message:n}),a.getAllWindows().forEach(o=>o.webContents.send(f.log,t,...n))}}log=(...t)=>this.#e("log",t);info=(...t)=>this.#e("info",t);warn=(...t)=>this.#e("warn",t);error=(...t)=>this.#e("error",t);debug=(...t)=>this.#e("debug",t)},$=L;var Q=new $("Preload"),Z={config:_.ipcRenderer.sendSync(f.getConfig),getStyles:()=>_.ipcRenderer.invoke(f.getStyles),onStatusMessage:e=>_.ipcRenderer.on(f.statusMessage,(t,n)=>e(n)),isSplash:xe(),getThemes:()=>_.ipcRenderer.invoke(f.getThemes),onThemeChange(e){let t=(n,i)=>e(i);return _.ipcRenderer.on(f.onThemeChange,t),()=>{Q.log("Stopping theme listener"),_.ipcRenderer.removeListener(f.onThemeChange,t)}},saveThemeState:(e,t)=>_.ipcRenderer.send(f.saveThemeState,e,t),getQuickCss:()=>_.ipcRenderer.invoke(f.getQuickCss),onQuickCssChange(e){let t=(n,i)=>e(i);return _.ipcRenderer.on(f.onQuickCssChange,t),()=>{Q.log("Stopping QuickCSS listener"),_.ipcRenderer.removeListener(f.onQuickCssChange,t)}},createQuickCssNode:(e,t)=>_.ipcRenderer.send(f.createQuickCssNode,e,t),deleteQuickCssNode:e=>_.ipcRenderer.send(f.deleteQuickCssNode,e),renameQuickCssNode:(e,t)=>_.ipcRenderer.send(f.renameQuickCssNode,e,t),updateQuickCssFile:(e,t)=>_.ipcRenderer.send(f.updateQuickCssFile,e,t)};try{let e=X();Z.validateCSS=e.validateText}catch{Q.info("Disabled CSS Validator")}_.contextBridge.exposeInMainWorld("PopcornNative",Z);_.ipcRenderer.on(f.log,(e,t,...n)=>{new $("Main")[t](...n)});function xe(){let e=["splash","Splash","SPLASH","__SPLASH","__SPLASH__","splashScreen","SplashScreen","SPLASHSCREEN","__SPLASHSCREEN","__SPLASHSCREEN__"];for(let n of e)if(window[n])return!0;let{windowOptions:t}=_.ipcRenderer.sendSync("KERNEL_WINDOW_DATA");return!t.webPreferences.nativeWindowOpen}
