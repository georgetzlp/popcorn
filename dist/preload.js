var ne=Object.create;var Q=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var oe=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var k=(e,t)=>()=>(e&&(t=e(e=0)),t);var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ue=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of re(t))!ae.call(e,r)&&r!==n&&Q(e,r,{get:()=>t[r],enumerable:!(i=ie(t,r))||i.enumerable});return e};var I=(e,t,n)=>(n=e!=null?ne(oe(e)):{},ue(t||!e||!e.__esModule?Q(n,"default",{value:e,enumerable:!0}):n,e));function $(e,t){let n={};for(let i in e)n[i]=t+e[i];return n}var O,f,Xe,Ze,D=k(()=>{O={main:"POPCORN_",quickCss:"QUICKCSS_"},f=$({getConfig:"GET_CONFIG",getStyles:"GET_STYLES",statusMessage:"STATUS_MESSAGE",getWindowData:"GET_WINDOW_DATA",log:"LOG",getThemes:"GET_THEMES",onThemeChange:"ON_THEME_CHANGE",saveThemeState:"SAVE_THEME_STATE",getQuickCss:"GET_QUICK_CSS",onQuickCssChange:"ON_QUICK_CSS_CHANGE",createQuickCssNode:"CREATE_QUICK_CSS_NODE",deleteQuickCssNode:"DELETE_QUICK_CSS_NODE",renameQuickCssNode:"RENAME_QUICK_CSS_NODE",updateQuickCssFile:"SAVE_QUICK_CSS_FILE"},O.main),Xe={quickCss:$({created:"CREATED",deleted:"DELETED",renamed:"RENAMED",updated:"UPDATED"},O.quickCss)},Ze=$({stop:"STOP"},O.main)});var w,L,G=k(()=>{D();w=class{constructor(t,n="console"){this.module=t;this.output=w.getOutput(n),this.output==="ansi"&&(this.logArchive=[],(async()=>{let{app:i}=await import("electron");i.on("web-contents-created",(r,a)=>{for(let o of this.logArchive)a.send(f.log,o.type,...o.message)})})())}output;logArchive;static getOutput(t){switch(t){case"ansi":case"terminal":return"ansi";default:return"console"}}static getColor(t){switch(t){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return{str:"gold",arr:[255,215,0]}}}static ansiColor(t,n){return`\x1B[38;2;${t[0]};${t[1]};${t[2]}m${n}\x1B[0m`}async#e(t,n){let i=w.getColor(t),r=this.output==="ansi"?[`[${w.ansiColor(i.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${i.str};`,""];if(console[t](...r,...n),this.output==="ansi"){let{BrowserWindow:a}=await import("electron");this.logArchive.push({type:t,message:n}),a.getAllWindows().forEach(o=>o.webContents.send(f.log,t,...n))}}log=(...t)=>this.#e("log",t);info=(...t)=>this.#e("info",t);warn=(...t)=>this.#e("warn",t);error=(...t)=>this.#e("error",t);debug=(...t)=>this.#e("debug",t)},L=w});var W=h(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});var U=["all","braille","embossed","handheld","print","projection","screen","speech","tty","tv"],H=[0,1,2,3];function se(e){if(e){if(e.medium&&!U.includes(e.medium))throw new Error(`The medium must be one of the following: ${U.join(", ")}`);if(e.warningLevel&&!H.includes(e.warningLevel))throw new Error(`The warning level must be one of the following: ${H.join(", ")}`);if(e.timeout!==void 0&&!Number.isInteger(e.timeout))throw new Error("The timeout must be an integer");if(e.timeout&&e.timeout<0)throw new Error("The timeout must be a positive integer")}}M.default=se});var j=h(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});var N=class extends Error{constructor(t,n){super(t),this.statusCode=n,this.name="BadStatusError"}};P.default=N});var S=h(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.boundaryLength=void 0;b.boundaryLength=34;var le=()=>{let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let n=0;n<10;n+=1)t+=e[Math.floor(Math.random()*e.length)];return`----CSSValidatorBoundary${t}`};b.default=le});var V=h(g=>{"use strict";var ce=g&&g.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(u){try{s(i.next(u))}catch(d){o(d)}}function l(u){try{s(i.throw(u))}catch(d){o(d)}}function s(u){u.done?a(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},de=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});var fe=de(j()),_e=S(),ve=(e,t,n)=>ce(void 0,void 0,void 0,function*(){let i=new AbortController;setTimeout(()=>{i.abort()},n);let r=null;try{if(r=yield fetch(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,signal:i.signal},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,_e.boundaryLength+2)}`,"Content-Length":String(new TextEncoder().encode(t).byteLength)},body:t}:{})),!r.ok)throw new fe.default(r.statusText,r.status)}catch(o){throw o instanceof Error&&o.name==="AbortError"?new Error(`The request took longer than ${n}ms`):o}if(!r)throw new Error("Response expected");return(yield r.json()).cssvalidation});g.default=ve});var F=h(v=>{"use strict";var he=v&&v.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),we=v&&v.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ge=v&&v.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&he(t,e,n);return we(t,e),t},pe=v&&v.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(u){try{s(i.next(u))}catch(d){o(d)}}function l(u){try{s(i.throw(u))}catch(d){o(d)}}function s(u){u.done?a(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},me=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var ye=ge(require("https")),be=me(j()),Ce=S(),Ee=require("util"),Se=(e,t,n)=>pe(void 0,void 0,void 0,function*(){return new Promise((i,r)=>{let a=ye.request(`https://jigsaw.w3.org/css-validator/validator${e==="GET"?t:""}`,Object.assign({method:e,timeout:n},e==="POST"?{headers:{"Content-Type":`multipart/form-data; boundary=${t.slice(2,Ce.boundaryLength+2)}`,"Content-Length":String(new Ee.TextEncoder().encode(t).byteLength)}}:{}),o=>{var c;typeof o.statusCode=="number"&&(o.statusCode<200||o.statusCode>=300)&&r(new be.default((c=o.statusMessage)!==null&&c!==void 0?c:"",o.statusCode));let l="";o.on("data",s=>{try{l+=s}catch(u){r(u)}}),o.on("end",()=>{try{i(JSON.parse(l).cssvalidation)}catch(s){r(s)}})});e==="POST"&&a.write(t),a.on("timeout",()=>{r(new Error(`The request took longer than ${n}ms`))}),a.end()})});v.default=Se});var K=h(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});function Te(e){var t;let n={uri:encodeURIComponent(e.url),usermedium:(t=e?.medium)!==null&&t!==void 0?t:"all",warning:e?.warningLevel?e.warningLevel-1:"no",output:"application/json",profile:"css3"};return`?${Object.entries(n).map(([i,r])=>`${i}=${r}`).join("&")}`}A.default=Te});var x=h(C=>{"use strict";var Oe=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var $e=Oe(S()),De=e=>{var t;let n=`\r
`,i=`--${(0,$e.default)()}`,r=[`Content-Disposition: form-data; name="text"${n}${n}${e.text}${n}`,`Content-Disposition: form-data; name="profile"${n}${n}css3${n}`,`Content-Disposition: form-data; name="output"${n}${n}application/json${n}`,`Content-Disposition: form-data; name="usermedium"${n}${n}${(t=e.medium)!==null&&t!==void 0?t:"all"}${n}`,`Content-Disposition: form-data; name="warning"${n}${n}${e?.warningLevel?String(e.warningLevel-1):"no"}${n}`];return`${i}${n}${r.join(`${i}${n}`)}${i}`};C.default=De});var Y=h(E=>{"use strict";var B=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0});var Le=B(K()),Me=B(x()),Ne=(e,t)=>{if(e==="GET"){if("text"in t)throw new Error("A GET request is not supported with validation by text");return(0,Le.default)(t)}if(e==="POST"){if("url"in t)throw new Error("A POST request is not supported with validation by URL");return(0,Me.default)(t)}throw new Error(`Parameter processing called with unrecognized method: ${e}`)};E.default=Ne});var q=h(p=>{"use strict";var Pe=p&&p.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(u){try{s(i.next(u))}catch(d){o(d)}}function l(u){try{s(i.throw(u))}catch(d){o(d)}}function s(u){u.done?a(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},T=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var je=T(W()),Ae=T(V()),qe=T(F()),Re=T(Y()),Qe=(e,t,n)=>Pe(void 0,void 0,void 0,function*(){(0,je.default)({timeout:n,medium:t.medium,warningLevel:t.warningLevel});let i=(0,Re.default)(e,t);return typeof window<"u"&&typeof window?.fetch=="function"?yield(0,Ae.default)(e,i,n):yield(0,qe.default)(e,i,n)});p.default=Qe});var z=h(m=>{"use strict";var ke=m&&m.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(u){try{s(i.next(u))}catch(d){o(d)}}function l(u){try{s(i.throw(u))}catch(d){o(d)}}function s(u){u.done?a(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},Ie=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var Ge=Ie(q());function Ue(e,t){var n,i,r;return ke(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in text to be validated");if(typeof e!="string")throw new Error("The text to be validated must be a string");let a=yield(0,Ge.default)("POST",{text:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),o={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},o),{warnings:[]}):o;return c.valid=a.validity,(i=a.errors)===null||i===void 0||i.forEach(l=>{c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim()})}),"warnings"in c&&((r=a.warnings)===null||r===void 0||r.forEach(l=>{c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1})})),c})}m.default=Ue});var J=h(y=>{"use strict";var He=y&&y.__awaiter||function(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function c(u){try{s(i.next(u))}catch(d){o(d)}}function l(u){try{s(i.throw(u))}catch(d){o(d)}}function s(u){u.done?a(u.value):r(u.value).then(c,l)}s((i=i.apply(e,t||[])).next())})},We=y&&y.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(y,"__esModule",{value:!0});var Ve=We(q());function Fe(e,t){var n,i,r;return He(this,void 0,void 0,function*(){if(!e)throw new Error("You must pass in a URL to be validated");if(typeof e!="string")throw new Error("The URL to be validated must be a string");let a=yield(0,Ve.default)("GET",{url:e,medium:t?.medium,warningLevel:t?.warningLevel},(n=t?.timeout)!==null&&n!==void 0?n:1e4),o={valid:!1,errors:[]},c=t?.warningLevel?Object.assign(Object.assign({},o),{warnings:[]}):o;return c.valid=a.validity,(i=a.errors)===null||i===void 0||i.forEach(l=>{var s;c.errors.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),url:(s=l.source)!==null&&s!==void 0?s:null})}),"warnings"in c&&((r=a.warnings)===null||r===void 0||r.forEach(l=>{var s;c.warnings.push({line:l.line,message:l.message.replace(/[ :]+$/,"").trim(),level:l.level+1,url:(s=l.source)!==null&&s!==void 0?s:null})})),c})}y.default=Fe});var ee=h((R,Z)=>{"use strict";var X=R&&R.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Ke=X(z()),xe=X(J()),Be={validateText:Ke.default,validateURL:xe.default};Z.exports=Be});var _=require("electron");D();G();var Ye=new L("Preload"),te={config:_.ipcRenderer.sendSync(f.getConfig),getStyles:()=>_.ipcRenderer.invoke(f.getStyles),onStatusMessage:e=>_.ipcRenderer.on(f.statusMessage,(t,n)=>e(n)),isSplash:ze(),getThemes:()=>_.ipcRenderer.invoke(f.getThemes),onThemeChange:e=>_.ipcRenderer.on(f.onThemeChange,(t,n)=>e(n)),saveThemeState:(e,t)=>_.ipcRenderer.send(f.saveThemeState,e,t),getQuickCss:()=>_.ipcRenderer.invoke(f.getQuickCss),onQuickCssChange:e=>_.ipcRenderer.on(f.onQuickCssChange,(t,n)=>e(n)),createQuickCssNode:(e,t)=>_.ipcRenderer.send(f.createQuickCssNode,e,t),deleteQuickCssNode:e=>_.ipcRenderer.send(f.deleteQuickCssNode,e),renameQuickCssNode:(e,t)=>_.ipcRenderer.send(f.renameQuickCssNode,e,t),updateQuickCssFile:(e,t)=>_.ipcRenderer.send(f.updateQuickCssFile,e,t)};try{let e=ee();te.validateCSS=e.validateText}catch{Ye.info("Disabled CSS Validator")}_.contextBridge.exposeInMainWorld("PopcornNative",te);_.ipcRenderer.on(f.log,(e,t,...n)=>{new L("Main")[t](...n)});function ze(){let e=["splash","Splash","SPLASH","__SPLASH","__SPLASH__","splashScreen","SplashScreen","SPLASHSCREEN","__SPLASHSCREEN","__SPLASHSCREEN__"];for(let n of e)if(window[n])return!0;let{windowOptions:t}=_.ipcRenderer.sendSync(f.getWindowData);return!t.webPreferences.nativeWindowOpen}
