var p=o=>{let e=new Set;do for(let t of Reflect.ownKeys(o))e.add([o,t]);while((o=Reflect.getPrototypeOf(o))&&o!==Object.prototype);return e};function h(o,{include:e,exclude:t}={}){let r=n=>{let s=a=>typeof a=="string"?n===a:a.test(n);return e?e.some(s):t?!t.some(s):!0};for(let[n,s]of p(o.constructor.prototype)){if(s==="constructor"||!r(s))continue;let a=Reflect.getOwnPropertyDescriptor(n,s);a&&typeof a.value=="function"&&(o[s]=o[s].bind(o))}return o}var l={str:"gold",arr:[255,215,0]},m=class{module;output;constructor(e,t="console"){this.module=e,this.output=this.#t(t)}#t(e){switch(e){case"ansi":case"terminal":return"ansi";default:return"console"}}#r(e){switch(e){case"info":case"warn":case"error":case"debug":return e;default:return"log"}}#n(e){switch(e){case"debug":return{str:"MediumSpringGreen",arr:[0,250,154]};case"info":return{str:"DeepSkyBlue",arr:[0,191,255]};case"error":return{str:"crimson",arr:[220,20,60]};case"warn":return{str:"DarkOrange",arr:[255,140,0]};default:return null}}#o(e,t){return`\x1B[38;2;${e[0]};${e[1]};${e[2]}m${t}\x1B[0m`}#e(e,t){let r=this.#n(e)??l,n=this.output==="ansi"?[`[${this.#o(r.arr,"Popcorn")} > ${this.module}]`]:[`[%cPopcorn%c > ${this.module}]`,`color: ${r.str||l.str};`,""];console[this.#r(e)](...n,...t)}log=(...e)=>this.#e("log",e);info=(...e)=>this.#e("info",e);warn=(...e)=>this.#e("warn",e);error=(...e)=>this.#e("error",e);debug=(...e)=>this.#e("debug",e)},c=m;var b=new c("Proxy"),u={get(o,e){return typeof o[e]=="object"&&o[e]!==null?new Proxy(o[e],this):o[e]},set:(o,e,t)=>(o[e]=t,!0)};var i=new c("Renderer"),g=await PopcornNative.config,$=new class{comments;themeElements=new Map;themeProxy;constructor(){h(this)}async start(){let t={themes:await PopcornNative.getThemes(),enable:this.enable,disable:this.disable,toggle:this.toggle};this.themeProxy=new Proxy(t.themes,u),t.themes=this.themeProxy,window.Popcorn=t;let r=document.createComment("section:Popcorn"),n=document.createComment("endsection");document.head.append(r,n),this.comments={start:r,end:n},this.populateThemes(),this.watchThemes()}async populateThemes(){for(let e of Object.keys(this.themeProxy)){let t=this.themeProxy[e];this.populateTheme(e),t.enabled&&await this.enable(e,!1)}}async watchThemes(){PopcornNative.onThemeChange(({id:e,theme:t})=>{g.verbose&&i.debug(`Theme changed: ${e}`),this.themeProxy[e]=t,this.populateTheme(e),this.updateTheme(e)})}async updateTheme(e){let t=this.themeElements.get(e);if(!t){i.warn(`No theme found with id: "${e}"`);return}t.textContent=this.themeProxy[e].css}async populateTheme(e){let t=this.themeProxy[e];t.enable=(r,n=!0)=>this.enable(r,n),t.disable=(r,n=!0)=>this.disable(r,n),t.toggle=(r,n=!0)=>this.toggle(r,n)}async enable(e,t=!0){let r=this.themeProxy[e];if(r.enabled=!0,this.themeElements.has(e)){i.log(`"${e}" is already enabled.`);return}let n=document.createElement("style");n.id=e,n.textContent=r.css,n.dataset.popcorn="true",this.comments.end.before(n),this.themeElements.set(e,n),PopcornNative.watchTheme(JSON.stringify(r)),i.log(`"${e}" enabled.`),t&&PopcornNative.saveState(e,!0)}async disable(e,t=!0){let r=this.themeProxy[e];r.enabled=!1;let n=this.themeElements.get(e);if(!n){i.warn(`"${e}" is not enabled.`);return}this.themeElements.delete(e),n.remove(),PopcornNative.unwatchTheme(JSON.stringify(r)),i.log(`"${e}" disabled.`),t&&PopcornNative.saveState(e,!1)}async toggle(e,t=!0){let r=this.themeProxy[e];r.enabled=!r.enabled,r.enabled?await this.enable(e,t):await this.disable(e,t)}async stop(){delete window.Popcorn;let e=[...document.querySelectorAll("[data-popcorn]"),...Object.values(this.comments)];for(let t of e)t.remove()}};export{$ as default};
